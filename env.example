# ========================================
# DEEPIRI ENVIRONMENT CONFIGURATION
# ========================================
# Copy this file to .env and configure for your deployment
# Supports both local development and Docker deployments
#
# IMPORTANT: For Kubernetes deployments, DO NOT use .env files directly.
# Instead, use ConfigMaps (for non-sensitive config) and Secrets (for sensitive data).
# This .env file is only for:
#   - Local development (running services directly)
#   - Docker Compose deployments
#   - Reference for creating Kubernetes ConfigMaps/Secrets
#
# Kubernetes Deployment:
#   - Local/Dev K8s (Minikube/Kind/k3d): Use ConfigMaps/Secrets with dev values
#   - Cloud K8s (EKS/GKE/AKS): Use ConfigMaps/Secrets with production values
#   - PROD_* variables below are ONLY for reference when creating cloud K8s Secrets

# ========================================
# DEPLOYMENT TYPE
# ========================================
DEPLOYMENT_TYPE=local                    # local|docker
DOCKER_ENVIRONMENT=development           # development|staging|production

# ========================================
# DATABASE CONFIGURATION
# ========================================
# PostgreSQL (if used)
DATABASE_URL=postgresql://username:password@localhost:5432/deepiri

# MongoDB
MONGODB_URI=mongodb://localhost:27017/deepiri
MONGODB_TEST_URI=mongodb://localhost:27017/deepiri_test
MONGO_ROOT_USER=admin
MONGO_ROOT_PASSWORD=password
MONGO_DB=deepiri

# Redis
REDIS_URL=redis://localhost:6379
REDIS_HOST=redis
REDIS_PORT=6379
REDIS_PASSWORD=redispassword

# Docker Internal URLs (for Docker deployments)
INTERNAL_MONGODB_URL=mongodb://admin:${MONGO_ROOT_PASSWORD}@mongodb:27017/${MONGO_DB}?authSource=admin
INTERNAL_REDIS_URL=redis://:${REDIS_PASSWORD}@redis:6379

# Kubernetes Internal URLs (for K8s deployments)
# In Kubernetes, services are accessed via service names:
# INTERNAL_MONGODB_URL=mongodb://admin:${MONGO_ROOT_PASSWORD}@mongodb:27017/${MONGO_DB}?authSource=admin
# INTERNAL_REDIS_URL=redis://:${REDIS_PASSWORD}@redis:6379
# INTERNAL_BACKEND_URL=http://backend-service:5000
# INTERNAL_CYREX_URL=http://cyrex-service:8000
# INTERNAL_LOCALAI_URL=http://localai-service:8080/v1

# ========================================
# PRODUCTION VALUES (Kubernetes Secrets Reference Only)
# ========================================
# NOTE: These are ONLY for reference when creating Kubernetes Secrets for cloud deployment.
# DO NOT use these in local .env files. For Kubernetes:
#   - Create a Secret with production values (e.g., PROD_MONGODB_URI â†’ MONGODB_URI)
#   - Use ConfigMaps for non-sensitive production config
# PROD_MONGODB_URI=mongodb+srv://user:pass@cluster.mongodb.net/deepiri_prod
# PROD_REDIS_URL=redis://prod-redis.cloud.com:6379
# PROD_JWT_SECRET=use-external-secret-manager
# PROD_OPENAI_API_KEY=use-external-secret-manager

# MongoDB Admin Interface
MONGO_EXPRESS_ENABLED=true
MONGO_EXPRESS_BASICAUTH=false

# ========================================
# JWT CONFIGURATION
# ========================================
JWT_SECRET=your-super-secret-jwt-key-here
JWT_EXPIRES_IN=7d
REFRESH_TOKEN_TTL_DAYS=30

# ========================================
# FIREBASE CONFIGURATION
# ========================================
FIREBASE_PROJECT_ID=your-firebase-project-id
FIREBASE_PRIVATE_KEY_ID=your-private-key-id
FIREBASE_PRIVATE_KEY="-----BEGIN PRIVATE KEY-----\nYour private key here\n-----END PRIVATE KEY-----\n"
FIREBASE_CLIENT_EMAIL=firebase-adminsdk-xxxxx@your-project.iam.gserviceaccount.com
FIREBASE_CLIENT_ID=your-client-id
FIREBASE_AUTH_URI=https://accounts.google.com/o/oauth2/auth
FIREBASE_TOKEN_URI=https://oauth2.googleapis.com/token

# ========================================
# AI & LLM CONFIGURATION
# ========================================
# AI Provider: openai | localai | deepinfra
AI_PROVIDER=openai

# OpenAI Configuration (Cloud Path)
OPENAI_API_KEY=your-openai-api-key-here
OPENAI_API_BASE=https://api.openai.com/v1
OPENAI_MODEL=gpt-4o-mini

# LocalAI Configuration (Local/Free Path)
# LocalAI is a drop-in replacement for OpenAI that runs locally
# Install: docker run -ti --name local-ai -p 8080:8080 localai/localai:latest
# Or use: curl https://localai.io/install.sh | sh
LOCALAI_API_BASE=http://localhost:8080/v1
LOCALAI_MODEL=gpt-4o-mini
LOCALAI_API_KEY=                  # Optional: set if LocalAI requires API key

# DeepInfra Configuration (Alternative Cloud Path)
DEEPINFRA_API_KEY=your-deepinfra-api-key-here
DEEPINFRA_API_BASE=https://api.deepinfra.com/v1/openai
DEEPINFRA_MODEL=meta-llama/Llama-3.1-8B-Instruct

# AI Configuration (applies to all providers)
AI_MAX_TOKENS=2000
AI_TEMPERATURE=0.7
AI_TOP_P=0.9

# Agent Configuration
OPENAI_AGENT_MODEL=gpt-4o-mini
AGENT_TEMPERATURE=0.5
AGENT_TOP_P=0.9

# Python Agent
CYREX_API_KEY=change-me

# ========================================
# RAG / EMBEDDINGS CONFIGURATION
# ========================================
# Vector Store: chromadb | postgres | mongodb | memory
VECTOR_STORE=chromadb

# ChromaDB Configuration (Local/Free Path)
CHROMADB_PATH=./chroma_db
CHROMADB_COLLECTION=deepiri_embeddings
CHROMADB_PERSIST=true

# Embedding Model
EMBEDDING_MODEL=all-minilm-l6-v2
EMBEDDING_DIMENSIONS=384

# ========================================
# EXTERNAL API KEYS
# ========================================
GOOGLE_MAPS_API_KEY=your-google-maps-api-key
GOOGLE_PLACES_API_KEY=your-google-places-api-key
OPENWEATHER_API_KEY=your-openweather-api-key
EVENTBRITE_API_KEY=your-eventbrite-api-key
YELP_API_KEY=your-yelp-api-key

# ========================================
# SERVER CONFIGURATION
# ========================================
PORT=5000
NODE_ENV=development
CORS_ORIGIN=http://localhost:5173
IP_ALLOW_LIST=
IP_DENY_LIST=

# Development URLs (Local/Docker)
DEV_CLIENT_URL=http://localhost:5173
DEV_API_URL=http://localhost:5000/api
DEV_CYREX_URL=http://localhost:8000

# Internal Docker Network URLs
INTERNAL_BACKEND_URL=http://backend:5000
INTERNAL_CYREX_URL=http://cyrex:8000

# Production URLs (Kubernetes ConfigMap Reference Only)
# For cloud K8s deployments, set these in ConfigMaps, not .env files
# PROD_CLIENT_URL=https://deepiri.com
# PROD_API_URL=https://api.deepiri.com
# PROD_CYREX_URL=https://agent.deepiri.com

# ========================================
# RATE LIMITING
# ========================================
RATE_LIMIT_WINDOW_MS=900000
RATE_LIMIT_MAX_REQUESTS=100

# ========================================
# CACHE CONFIGURATION
# ========================================
CACHE_TTL_ADVENTURES=3600
CACHE_TTL_EVENTS=1800
CACHE_TTL_WEATHER=900
CACHE_TTL_MAPS=3600

# ========================================
# CHALLENGE GENERATION
# ========================================
DEFAULT_CHALLENGE_DURATION=30
MAX_CHALLENGE_DURATION=120
MIN_CHALLENGE_DURATION=5
DEFAULT_CHALLENGE_DIFFICULTY=medium

# ========================================
# DOCKER CONFIGURATION
# ========================================
# Container Configuration
DOCKER_RESTART_POLICY=unless-stopped
DOCKER_MEMORY_LIMIT=512m
DOCKER_CPU_LIMIT=0.5
DOCKER_SWAP_LIMIT=1g

# Network Settings
DOCKER_NETWORK_NAME=deepiri-network
DOCKER_SUBNET=172.20.0.0/16
DOCKER_GATEWAY=172.20.0.1

# Service Ports (HOST:CONTAINER)
FRONTEND_PORT=5173:5173               # Vite dev server (development)
FRONTEND_PROD_PORT=3000:80            # Nginx (production)
BACKEND_PORT=5000:5000
CYREX_PORT=8000:8000
LOCALAI_PORT=8080:8080              # LocalAI service port
MONGODB_PORT=27017:27017
REDIS_PORT=6379:6379
MONGO_EXPRESS_PORT=8081:8081
PROMETHEUS_PORT=9090:9090
GRAFANA_PORT=3001:3000
NGINX_HTTP_PORT=80:80
NGINX_HTTPS_PORT=443:443

# Service Dependencies
WAIT_FOR_MONGODB=true
WAIT_FOR_REDIS=true
WAIT_FOR_BACKEND=true

# Health Check Settings
HEALTH_CHECK_INTERVAL=30s
HEALTH_CHECK_TIMEOUT=10s
HEALTH_CHECK_RETRIES=3
HEALTH_CHECK_START_PERIOD=40s

# Volume Configuration
MONGODB_DATA_VOLUME=mongodb_data
REDIS_DATA_VOLUME=redis_data
LOGS_VOLUME=./logs
CLIENT_SOURCE_VOLUME=./client:/app
SERVER_SOURCE_VOLUME=./server:/app
PYTHON_SOURCE_VOLUME=./diri-cyrex:/app
SERVER_CONFIG_VOLUME=./server/config:/app/config:ro
NGINX_CONFIG_VOLUME=./ops/nginx/nginx.conf:/etc/nginx/nginx.conf:ro

# Development Features
HMR_ENABLED=true
CHOKIDAR_USEPOLLING=true
WATCHPACK_POLLING=true
DEV_TOOLS_ENABLED=true
DEBUG_MODE=true
VERBOSE_LOGGING=true
WATCH_FILES=true
WATCH_INTERVAL=100

# Monitoring & Observability
PROMETHEUS_ENABLED=true
PROMETHEUS_CONFIG=./ops/prometheus/prometheus.yml
GRAFANA_ENABLED=true
GRAFANA_ADMIN_PASSWORD=docker_grafana_admin_123
LOG_DRIVER=json-file
LOG_MAX_SIZE=10m
LOG_MAX_FILE=3

# Security (Docker)
DOCKER_SECURITY_OPTS=no-new-privileges:true
DOCKER_READONLY_ROOT=false
DOCKER_USER_NAMESPACE=false
DOCKER_INTERNAL_NETWORK=true
DOCKER_EXPOSE_PORTS_TO_HOST=true
DOCKER_SECRETS_DIR=/run/secrets
USE_DOCKER_SECRETS=false

# Build Configuration
DOCKER_BUILD_TARGET=development        # development|production
DOCKER_BUILD_PLATFORM=linux/amd64
DOCKER_BUILD_CACHE=true
BUILD_STAGE=development
FRONTEND_BUILD_STAGE=development
BACKEND_BUILD_STAGE=development

# Scaling Configuration (Kubernetes Deployment Reference Only)
# These are set in Kubernetes Deployment manifests, not .env files
# PROD_BACKEND_REPLICAS=3
# PROD_FRONTEND_REPLICAS=2
# PROD_CYREX_REPLICAS=2

# Backup & Recovery
BACKUP_ENABLED=false
BACKUP_SCHEDULE=0 2 * * *              # Daily at 2 AM
BACKUP_RETENTION_DAYS=30
BACKUP_COMPRESSION=gzip
BACKUP_S3_BUCKET=deepiri-docker-backups
BACKUP_AWS_REGION=us-east-1

# Reverse Proxy (Nginx)
NGINX_LOAD_BALANCING=round_robin
NGINX_UPSTREAM_KEEPALIVE=32
NGINX_SSL_ENABLED=false
NGINX_SSL_CERT_PATH=/etc/nginx/ssl/cert.pem
NGINX_SSL_KEY_PATH=/etc/nginx/ssl/key.pem
NGINX_STATIC_CACHE=24h
NGINX_API_CACHE=5m

# Docker Compose Profiles
PROFILE_DEVELOPMENT=true
PROFILE_TESTING=false
PROFILE_PRODUCTION=false
PROFILE_MONITORING=true
PROFILE_ADMIN_TOOLS=true

# ========================================
# KUBERNETES DEPLOYMENT REFERENCE
# ========================================
# For Kubernetes deployments, create ConfigMaps and Secrets instead of using .env files.
#
# Example ConfigMap (non-sensitive config):
# ---
# apiVersion: v1
# kind: ConfigMap
# metadata:
#   name: deepiri-config
# data:
#   NODE_ENV: "development"
#   PORT: "5000"
#   AI_PROVIDER: "localai"
#   LOCALAI_API_BASE: "http://localai-service:8080/v1"
#   DEV_CLIENT_URL: "http://localhost:5173"
#
# Example Secret (sensitive data):
# ---
# apiVersion: v1
# kind: Secret
# metadata:
#   name: deepiri-secrets
# stringData:
#   JWT_SECRET: "your-secret-key"
#   OPENAI_API_KEY: "your-api-key"
#   MONGO_ROOT_PASSWORD: "password"
#   REDIS_PASSWORD: "redispassword"
#
# In your Deployment, reference them:
# envFrom:
#   - configMapRef:
#       name: deepiri-config
#   - secretRef:
#       name: deepiri-secrets
#
# For cloud K8s, create separate ConfigMaps/Secrets with production values.
# Local dev K8s (Minikube/Kind/k3d) can use the same structure with dev values.
