# ========================================
# DEEPIRI DOCKER ENVIRONMENT CONFIGURATION
# ========================================
# Copy this to .env.docker and configure for Docker deployments

# ========================================
# DEPLOYMENT TYPE
# ========================================
DEPLOYMENT_TYPE=docker
DOCKER_ENVIRONMENT=development          # development|staging|production

# ========================================
# CONTAINER CONFIGURATION
# ========================================
# Restart Policies
DOCKER_RESTART_POLICY=unless-stopped

# Resource Limits
DOCKER_MEMORY_LIMIT=512m
DOCKER_CPU_LIMIT=0.5
DOCKER_SWAP_LIMIT=1g

# Network Settings
DOCKER_NETWORK_NAME=deepiri-network
DOCKER_SUBNET=172.20.0.0/16
DOCKER_GATEWAY=172.20.0.1

# ========================================
# SERVICE PORTS (HOST:CONTAINER)
# ========================================
# Frontend
FRONTEND_PORT=5173:5173               # Vite dev server (development)
FRONTEND_PROD_PORT=3000:80            # Nginx (production)

# Backend API
BACKEND_PORT=5000:5000

# Python Agent
PYAGENT_PORT=8000:8000

# Databases
MONGODB_PORT=27017:27017
REDIS_PORT=6379:6379

# Admin Interfaces
MONGO_EXPRESS_PORT=8081:8081

# Monitoring
PROMETHEUS_PORT=9090:9090
GRAFANA_PORT=3001:3000

# Reverse Proxy (production)
NGINX_HTTP_PORT=80:80
NGINX_HTTPS_PORT=443:443

# ========================================
# DATABASE CONFIGURATION (DOCKER)
# ========================================
# MongoDB
MONGO_ROOT_USER=admin
MONGO_ROOT_PASSWORD=docker_mongo_password_123
MONGO_DB=deepiri

# MongoDB Admin Interface
MONGO_EXPRESS_ENABLED=true
MONGO_EXPRESS_BASICAUTH=false

# Redis
REDIS_PASSWORD=docker_redis_password_123

# ========================================
# SERVICE DEPENDENCIES
# ========================================
# Service startup order (healthcheck dependent)
WAIT_FOR_MONGODB=true
WAIT_FOR_REDIS=true
WAIT_FOR_BACKEND=true

# Health Check Settings
HEALTH_CHECK_INTERVAL=30s
HEALTH_CHECK_TIMEOUT=10s
HEALTH_CHECK_RETRIES=3
HEALTH_CHECK_START_PERIOD=40s

# ========================================
# VOLUME CONFIGURATION
# ========================================
# Persistent Data
MONGODB_DATA_VOLUME=mongodb_data
REDIS_DATA_VOLUME=redis_data
LOGS_VOLUME=./logs

# Development Volumes (for HMR)
CLIENT_SOURCE_VOLUME=./client:/app
SERVER_SOURCE_VOLUME=./server:/app
PYTHON_SOURCE_VOLUME=./python_backend:/app

# Configuration Volumes
SERVER_CONFIG_VOLUME=./server/config:/app/config:ro
NGINX_CONFIG_VOLUME=./ops/nginx/nginx.conf:/etc/nginx/nginx.conf:ro

# ========================================
# ENVIRONMENT OVERRIDES
# ========================================
# Development vs Production URLs
DEV_CLIENT_URL=http://localhost:5173
DEV_API_URL=http://localhost:5000/api
DEV_PYAGENT_URL=http://localhost:8000

PROD_CLIENT_URL=https://deepiri.com
PROD_API_URL=https://api.deepiri.com
PROD_PYAGENT_URL=https://agent.deepiri.com

# Internal Docker Network URLs
INTERNAL_BACKEND_URL=http://backend:5000
INTERNAL_PYAGENT_URL=http://pyagent:8000
INTERNAL_MONGODB_URL=mongodb://admin:${MONGO_ROOT_PASSWORD}@mongodb:27017/${MONGO_DB}?authSource=admin
INTERNAL_REDIS_URL=redis://:${REDIS_PASSWORD}@redis:6379

# ========================================
# DEVELOPMENT FEATURES
# ========================================
# Hot Module Replacement
HMR_ENABLED=true
CHOKIDAR_USEPOLLING=true
WATCHPACK_POLLING=true

# Development Tools
DEV_TOOLS_ENABLED=true
DEBUG_MODE=true
VERBOSE_LOGGING=true

# File Watching
WATCH_FILES=true
WATCH_INTERVAL=100

# ========================================
# MONITORING & OBSERVABILITY
# ========================================
# Prometheus Monitoring
PROMETHEUS_ENABLED=true
PROMETHEUS_CONFIG=./ops/prometheus/prometheus.yml

# Grafana Dashboard
GRAFANA_ENABLED=true
GRAFANA_ADMIN_PASSWORD=docker_grafana_admin_123

# Logging
LOG_DRIVER=json-file
LOG_MAX_SIZE=10m
LOG_MAX_FILE=3

# ========================================
# SECURITY (DOCKER)
# ========================================
# Container Security
DOCKER_SECURITY_OPTS=no-new-privileges:true
DOCKER_READONLY_ROOT=false
DOCKER_USER_NAMESPACE=false

# Network Security
DOCKER_INTERNAL_NETWORK=true
DOCKER_EXPOSE_PORTS_TO_HOST=true

# Secrets Management
DOCKER_SECRETS_DIR=/run/secrets
USE_DOCKER_SECRETS=false

# ========================================
# BUILD CONFIGURATION
# ========================================
# Build Arguments
DOCKER_BUILD_TARGET=development        # development|production
DOCKER_BUILD_PLATFORM=linux/amd64
DOCKER_BUILD_CACHE=true

# Multi-stage Build Settings
BUILD_STAGE=development
FRONTEND_BUILD_STAGE=development
BACKEND_BUILD_STAGE=development

# ========================================
# PRODUCTION OVERRIDES
# ========================================
# Production Database (external)
PROD_MONGODB_URI=mongodb+srv://user:pass@cluster.mongodb.net/deepiri_prod
PROD_REDIS_URL=redis://prod-redis.cloud.com:6379

# Production Secrets (use external secret management)
PROD_JWT_SECRET=use-external-secret-manager
PROD_OPENAI_API_KEY=use-external-secret-manager

# Production Scaling
PROD_BACKEND_REPLICAS=3
PROD_FRONTEND_REPLICAS=2
PROD_PYAGENT_REPLICAS=2

# ========================================
# BACKUP & RECOVERY
# ========================================
# Automated Backups
BACKUP_ENABLED=false
BACKUP_SCHEDULE=0 2 * * *              # Daily at 2 AM
BACKUP_RETENTION_DAYS=30
BACKUP_COMPRESSION=gzip

# Cloud Storage (for backups)
BACKUP_S3_BUCKET=deepiri-docker-backups
BACKUP_AWS_REGION=us-east-1

# ========================================
# REVERSE PROXY (NGINX)
# ========================================
# Load Balancing
NGINX_LOAD_BALANCING=round_robin
NGINX_UPSTREAM_KEEPALIVE=32

# SSL/TLS (Production)
NGINX_SSL_ENABLED=false
NGINX_SSL_CERT_PATH=/etc/nginx/ssl/cert.pem
NGINX_SSL_KEY_PATH=/etc/nginx/ssl/key.pem

# Caching
NGINX_STATIC_CACHE=24h
NGINX_API_CACHE=5m

# ========================================
# DEVELOPMENT PROFILES
# ========================================
# Docker Compose Profiles
PROFILE_DEVELOPMENT=true
PROFILE_TESTING=false
PROFILE_PRODUCTION=false
PROFILE_MONITORING=true
PROFILE_ADMIN_TOOLS=true
